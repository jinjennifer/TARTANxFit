{% extends "TxFApp/base.html" %}
{% block content %}

<!-- Display flash messages if there are any -->
{% include 'TxFApp/flash_message.html' %}

<h3> My Account </h3>
<div class="row">
	<div class="col-xs-12">
		<h4>History</h4>
	</div>
</div>

<div class="row">
	<div class="col-xs-6">
		<div class="card">
			<div class="card-content">
				<h3>{{points}} </h3>
				<p>POINTS</p>
			</div>
		</div>
	</div>
	<div class="col-xs-6">
		<div class="card">
			<div class="card-content">
				<h3>{{visits}} </h3>
				<p>VISITS</p>
			</div>
		</div>
	</div>
</div>

<h4>Upcoming and Today's Classes</h4>
<div class="list-group">
	{% for rsvp in rsvps %}
    {% with rsvp.course.class_schedule as c %}
        <a href="/classes/{{ c.id }}/" class="list-group-item">
			<h4 class="list-group-item-heading"> {{c.class_type.name}} </h4>
			<div class="row">
			<p class="list-group-item-text col-xs-8"><i class="fa fa-calendar icon"></i> {{rsvp.course.date}} <br>
			<i class="fa fa-clock-o icon"></i> {{c.start_time | time:'g:i a'}} - {{c.end_time | time:'g:i a'}} </p>
	    {% if rsvp.course.has_occurred %}
	    <form class="list-group-item-text col-xs-4" action="/account" method="post">
	        <input name="class_id" type="hidden" value="{{rsvp.course.id}}"/>
			<input name="type" type="hidden" value="attended"/>
	            <button id="rsvpButton" type ="submit" class='btn btn-secondary'><i class="fa fa-check fa-lg"></i> I attended!</button>
	        {% csrf_token %}
	    </form>
	    {% else %} <!-- hasnt occured, option to cancel rsvp -->
	    <form class="list-group-item-text col-xs-4" action="/account" method="post">
	        <input name="class_id" type="hidden" value="{{rsvp.course.id}}"/>
	        <input name="type" type="hidden" value="cancel"/>
	            <button id="rsvpButton" type ="submit" class='btn btn-secondary'><i class="fa fa-times fa-lg"></i> Cancel RSVP</button>
	        {% csrf_token %}
	    </form>
	    {% endif %}
	</div>
        </a>
    {% endwith %}
    {% empty %}
    	<p>You have not RSVPed for any classes. Check out the <a href="/schedule">class schedule!</a></p>
    {% endfor %}
</div>

<h4>Recently Attended Classes</h4>
<div class="list-group">
	{% for class in attended %}
	{% with class.course.class_schedule as c %}
        <a href="/classes/{{ class.course.class_schedule.id }}/" class="list-group-item">
			<h4 class="list-group-item-heading"> {{c.class_type.name}} </h4>
			<p class="list-group-item-text"><i class="fa fa-calendar icon"></i> {{class.course.date}} <br>
			<i class="fa fa-clock-o icon"></i> {{c.start_time }} - {{c.end_time}} </p>
        </a>
    {% endwith %}
    {% empty %}
		<p>You have not attended any classes. Check out the <a href="/schedule">class schedule!</a></p>
    {% endfor %}
</div>


<h4>My Competitions</h4>
<div class="list-group">
	{% for c in competitions %}
        <a href="#" class="list-group-item">{{c.name}}</a>
    {% endfor %}
    <a href="#" class="list-group-item list-group-item-success">Create New</a>
</div>
{% endblock %}